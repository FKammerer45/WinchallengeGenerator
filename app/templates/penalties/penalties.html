{# app/templates/penalties/penalties.html #}

{% extends "base.html" %}
{% block title %}Penalties Configuration{% endblock %}
{% import "_form_helpers.html" as forms %}

{% block head %}
    {{ super() }}
    {# Link the shared CSS for tab styling #}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/tabs.css') }}">
    {# The CSS you provided already handles custom-tabs-row margin, so inline style might not be needed #}
    {# If specific margin is still desired for the custom row, it can be kept or moved to tabs.css #}
    {# <style>
        .custom-tabs-row {
            margin-top: 1rem; 
        }
    </style> #}
{% endblock %}


{% block content %}
<div class="container mt-4 mb-5 config-page-container">
  <header class="mb-4 text-center">
    <h2 class="page-title"><i class="bi bi-shield-exclamation me-2"></i>Penalties Configuration</h2>
    <p class="text-secondary lead fs-6">
      Define and organize penalties for your challenges.
    </p>
  </header>

  <script>
    const isLoggedIn = {{ current_user.is_authenticated| tojson }};
    const csrfToken = "{{ csrf_token() }}";
    window.isLoggedIn = isLoggedIn;
    window.csrfToken = csrfToken;
    window.SYSTEM_DEFAULT_PENALTY_TABS = {}; // For penalties
  </script>


  <div class="d-flex justify-content-between align-items-center mb-3 action-button-row">
      <div class="btn-group" role="group" aria-label="Penalty Tab Actions">
          <button id="duplicatePenaltyTabBtn" class="btn btn-outline-info btn-sm" title="Create a copy of the current penalty tab">
              <i class="bi bi-front"></i>Duplicate Tab
          </button>
          <button id="deletePenaltyTabBtn" class="btn btn-outline-danger btn-sm" title="Delete the currently active custom penalty tab">
              <i class="bi bi-trash3"></i>Delete Current Tab
          </button>
      </div>
      <small class="text-secondary">Max 5 custom tabs allowed (excluding system defaults).</small>
  </div>


  {# --- Tabs Navigation Area --- #}
  {# Row 1: System Default Penalty Tabs #}
  <div class="nav-tabs-wrapper" id="systemPenaltyTabsWrapper">
    <ul class="nav nav-tabs mb-0 d-flex flex-wrap" id="penaltiesSystemTabList" role="tablist">
      <li class="nav-item system-default-group-label" id="systemPenaltyTabsLabel" style="display: none;">Default Penalty Sets</li>
      {# System default penalty tab LIs will be inserted here by JS #}
      <li id="loadingSystemPenaltyTabsPlaceholder" class="nav-item align-self-center" style="display: none;">
        <span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
        <span class="loading-placeholder-text small">Loading Default Sets...</span>
      </li>
    </ul>
  </div>

  {# Row 2: Custom Penalty Tabs #}
  <div class="nav-tabs-wrapper custom-tabs-row" id="customPenaltyTabsWrapper">
    <ul class="nav nav-tabs mb-0 d-flex flex-wrap" id="penaltiesCustomTabList" role="tablist">
      <li class="nav-item custom-group-label" id="customPenaltyTabsLabel" style="display: none;">Your Custom Penalty Sets</li>
      {# Custom penalty tab LIs will be inserted here by JS #}
      <li class="nav-item ms-auto order-last" id="addPenaltyTabBtnContainer"> 
        <a class="nav-link add-tab-button" href="#" id="addPenaltyTabBtn" role="tab" title="Add New Custom Penalty Tab">
          <i class="bi bi-plus-lg"></i> 
        </a>
      </li>
      <li id="loadingCustomPenaltyTabsPlaceholder" class="nav-item align-self-center order-last" style="display: none;">
        <span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
        <span class="loading-placeholder-text small">Loading Your Sets...</span>
      </li>
    </ul>
  </div>
  {# --- End Tabs Navigation --- #}

  <div class="tab-content" id="penaltiesTabContent">
    {# JS will insert tab panes here #}
  </div>

  {{ forms.confirm_action_modal(modal_id='actionConfirmModal', title_id='actionConfirmTitle', body_id='actionConfirmBody', ok_id='actionConfirmOk') }}
  {% include "penalties/penalties_modals.html" %}
  {{ forms.rename_tab_modal('penalty') }} {# Use 'penalty' context for this modal #}

</div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script type="module" src="{{ url_for('static', filename='js/utils/api.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/utils/helpers.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/penalties/penaltyLocalStorageUtils.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/penalties/penaltyTabManagement.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/penalties/penaltyEntryManagement.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/penalties/penaltyExtensions.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/penalties/penalties.js') }}"></script>
{% endblock %}

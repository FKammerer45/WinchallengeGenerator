{# templates/challenge/_challenge_details.html #}
{# Displays the normal and b2b win requirements for a challenge #}
{# Expects: c (challenge_data object) #}

<div class="card bg-dark text-light border-secondary">
  <div class="card-header"><strong>Challenge Details</strong></div>
  <div class="card-body">

    {# Normal Wins Section #}
    {% if c.normal %}
      <h5 class="card-title">Normal Wins</h5>
      <div class="table-responsive">
          <table class="table table-sm table-dark table-striped table-hover">
            <thead><tr><th style="width: 50%;">Game (Mode)</th><th style="width: 15%;">Wins</th><th>Progress</th></tr></thead>
            <tbody>
            {% for key, info in c.normal.items()|sort %} {# Sort by game name #}
              <tr>
                <td class="py-2">{{ key | escape }}<br><small class="text-muted">(Total Diff: {{ info.diff|round(2) }})</small></td>
                <td class="py-2">{{ info.count }}</td>
                <td class="py-2">
                  {% for i in range(info.count|int) %}
                    <input type="checkbox" class="form-check-input ml-1" aria-label="Win {{ i+1 }} for {{ key | escape }}">
                  {% endfor %}
                </td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
      </div>
    {% endif %}

    {# Back-to-Back Wins Section #}
    {% if c.b2b %}
      {% if c.normal %}<hr class="border-secondary">{% endif %} {# Separator #}
      <h5 class="mt-3 card-title">Back-to-Back Segments</h5>
       <div class="table-responsive">
          <table class="table table-sm table-dark table-striped table-hover">
            <thead><tr><th style="width: 50%;">Game (Mode) / Segment</th><th style="width: 15%;">Wins</th><th>Progress</th></tr></thead>
            <tbody>
            {# Outer loop for segments #}
            {% for seg in c.b2b %}
              {% set outer_loop_index = loop.index %} {# Capture outer index #}
              {# Segment Header Row #}
              <tr><td colspan="3" class="pt-3 font-weight-bold bg-secondary text-light">Segment {{ outer_loop_index }} <small class="font-weight-normal">({{ seg.length }} wins, Diff: {{ seg.seg_diff|round(2) }})</small></td></tr>
              {# Inner loop for wins within the segment #}
              {% for key, count in seg.group.items()|sort %} {# Sort wins within segment #}
                <tr>
                  <td class="pl-3 py-2">{{ key | escape }}</td>
                  <td class="py-2">{{ count }}</td>
                  <td class="py-2">
                    {% for i in range(count|int) %}
                      {# Use captured outer index in label #}
                      <input type="checkbox" class="form-check-input ml-1" aria-label="Segment {{ outer_loop_index }} Win {{ i+1 }} for {{ key | escape }}">
                    {% endfor %}
                  </td>
                </tr>
              {% endfor %} {# End inner loop (seg.group.items) #}
            {% endfor %} {# End outer loop (c.b2b) #}
            </tbody>
          </table>
        </div>
    {% endif %}

    {# Fallback if no wins listed #}
    {% if not c.normal and not c.b2b %}
        <p class="text-muted">Challenge details missing or empty.</p>
    {% endif %}
  </div> {# End card-body #}
</div> {# End Challenge Details Card #}
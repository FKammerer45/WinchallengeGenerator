{% extends "base.html" %}
{% from "_form_helpers.html" import render_field %}

{% block title %}Login - Win Challenge Generator{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>Login</h2>

  {# Flash messages #}
  {% include '_flash_messages.html' ignore missing %}

  {# --- Standard Login Form --- #}
  <form method="POST" action="{{ url_for('auth.login') }}">
    {{ form.hidden_tag() }}

    <div class="mb-3">
      {{ render_field(form.username, class="form-control", placeholder="Enter your username") }}
    </div>
    <div class="mb-3">
      {{ render_field(form.password, class="form-control", placeholder="Enter your password") }}
    </div>

    {# reCAPTCHA if enabled #}
    {% if recaptcha_enabled and recaptcha_public_key %}
      <div class="form-group mb-3 d-flex justify-content-center">
        <div class="g-recaptcha" data-sitekey="{{ recaptcha_public_key }}"></div>
      </div>
    {% elif recaptcha_enabled %}
      <p class="text-danger small mb-3">
        reCAPTCHA is enabled but the site key is missing.
      </p>
    {% endif %}

    {{ form.submit(class="btn btn-primary") }}
  </form>

  {# --- Divider --- #}
  <div class="text-center my-3">
    <span class="text-muted">or</span>
  </div>

  {# --- Twitch OAuth Login Button --- #}
  <div class="text-center">
    <a
    href="{{ url_for('auth_twitch.twitch_login') }}"
      class="btn btn-outline-secondary"
      title="Login with Twitch"
    >
      <i class="bi bi-twitch"></i>  {# Bootstrap icon, ensure you have bootstrap-icons #}
      Login with Twitch
    </a>
  </div>

  <p class="mt-3 text-center">
    Don't have an account?
    <a href="{{ url_for('auth.register') }}">Register here</a>.
  </p>
</div>
{% endblock %}

{% block scripts %}
  {{ super() if super }}
  {% if recaptcha_enabled and recaptcha_public_key %}
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  {% endif %}
{% endblock %}

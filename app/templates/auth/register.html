{% extends "base.html" %}
{% from "_form_helpers.html" import render_field %} {# Optional: Import macro #}

{% block title %}Register - Win Challenge Generator{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>Register</h2>

  {# Display flashed messages (includes WTForms validation errors if flashed in route) #}
  {% include '_flash_messages.html' ignore missing %}

  {# Use the form passed from the route #}
  <form method="POST" action="{{ url_for('auth.register') }}">
      {{ form.hidden_tag() }} {# CSRF token #}

      {# Render fields using WTForms (Macro example) #}
      <div class="mb-3">
          {{ render_field(form.username, class="form-control", placeholder="Enter username (min 6 chars)", value=request.form.get('username', '')) }} 
          {# Note: Repopulating might be automatic with WTForms, check behavior #}
          {# Or pass username=form.username.data in render_template on error #}
      </div>
      <div class="mb-3">
          {{ render_field(form.password, class="form-control", placeholder="Enter password (min 6 chars, 1 letter, 1 number)") }}
      </div>
      <div class="mb-3">
          {{ render_field(form.confirm_password, class="form-control", placeholder="Confirm your password") }}
      </div>

      {# --- reCAPTCHA Integration (remains the same) --- #}
      {% if recaptcha_enabled and recaptcha_public_key %}
      <div class="form-group mb-3 d-flex justify-content-center"> 
          <div class="g-recaptcha" data-sitekey="{{ recaptcha_public_key }}"></div>
      </div>
       {% elif recaptcha_enabled and not recaptcha_public_key %}
           <p class="text-danger small mb-3">reCAPTCHA is enabled but the site key is missing.</p> 
      {% endif %}
      {# --- End reCAPTCHA Integration --- #}

      {# Render submit button #}
      {{ form.submit(class="btn btn-primary") }}
  </form>

  <p class="mt-3">
    Already have an account? <a href="{{ url_for('auth.login') }}">Login here</a>.
  </p>
</div>
{% endblock %}

{% block scripts %}
  {{ super() if super }} 
  {% if recaptcha_enabled and recaptcha_public_key %}
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  {% endif %}
{% endblock %}

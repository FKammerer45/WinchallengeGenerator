{% extends "base.html" %}

{% block title %}Register - Win Challenge Generator{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>Register</h2>

  {# Display flashed messages (e.g., validation errors) #}
  {% include '_flash_messages.html' ignore missing %}

  <form method="post" action="{{ url_for('auth.register') }}">
    {# Keep CSRF token if your app uses it #}
    <input type="hidden" name="csrf_token" value="{{ csrf_token() if csrf_token else '' }}">

    <div class="form-group mb-3"> {# Added mb-3 for spacing #}
      <label for="username">Username:</label>
      <input
        type="text"
        class="form-control"
        name="username" {# Use name attribute for form submission #}
        id="username" {# Added id for label association #}
        required
        minlength="6"
        placeholder="Enter username (min 6 chars)"
        title="Username must be at least 6 characters long"
        value="{{ username or '' }}"> {# Repopulate username on error #}
    </div>

    <div class="form-group mb-3"> {# Added mb-3 for spacing #}
      <label for="password">Password:</label>
      <input
        type="password"
        class="form-control"
        name="password" {# Use name attribute #}
        id="password" {# Added id #}
        required
        minlength="6"
        pattern="(?=.*\d).{6,}" {# Keep client-side pattern #}
        placeholder="Enter password (min 6 chars, 1 number)"
        title="Password must be at least 6 characters long and contain at least one number">
    </div>

    <div class="form-group mb-3"> {# Added mb-3 for spacing #}
      <label for="confirm_password">Confirm Password:</label>
      <input
        type="password"
        class="form-control"
        id="confirm_password"
        name="confirm_password"
        required
        placeholder="Confirm your password">
    </div>

    {# --- reCAPTCHA Integration --- #}
    {# Conditionally render if enabled and key is provided #}
    {% if recaptcha_enabled and recaptcha_public_key %}
    <div class="form-group mb-3 d-flex justify-content-center"> {# Added mb-3 and centering #}
        {# Use the correct variable name passed from the route #}
        <div class="g-recaptcha" data-sitekey="{{ recaptcha_public_key }}"></div>
    </div>
     {% elif recaptcha_enabled and not recaptcha_public_key %}
         {# Optional: Display a warning if enabled but key missing #}
         <p class="text-danger small mb-3">reCAPTCHA is enabled but the site key is missing.</p> {# Bootstrap danger color #}
    {% endif %}
    {# --- End reCAPTCHA Integration --- #}

    <button type="submit" class="btn btn-primary">Register</button>
  </form>

  <p class="mt-3">
    Already have an account? <a href="{{ url_for('auth.login') }}">Login here</a>.
  </p>
</div>
{% endblock %}

{% block scripts %}
  {{ super() if super }} {# Include scripts from base template if needed #}
  {# Conditionally load reCAPTCHA script if enabled and key is present #}
  {% if recaptcha_enabled and recaptcha_public_key %}
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
  {% endif %}
{% endblock %}

{% extends "base.html" %}

{% block title %}My Challenges{% endblock %}

{% block head %}
    {{ super() }}
    {# Base style.css is linked in base.html #}
    {# Optional: Add page-specific style if needed #}
    <style> body { background-color: var(--base-bg, #030712); } </style>
{% endblock %}


{% block content %}
{# Added page specific class #}
<div class="container mt-4 my-challenges-page">
    <h1 class="mb-4 page-title">My Challenges</h1>

    {# Container for status messages #}
    <div id="deleteStatus" class="mb-4"></div>

    {# --- Section for Challenges Saved to Account --- #}
    <h3 class="mb-4 section-heading">Saved to Account</h3>
    <div id="myChallengesContainer">
        {% if current_user.is_authenticated and user_challenges %}
            <div class="row">
                {% for challenge in user_challenges %}
                    <div class="col-md-6 col-lg-4 mb-4 challenge-list-item">
                        {# *** Use list-card and glass-effect classes *** #}
                        <div class="card list-card h-100 glass-effect">
                            <a href="{{ url_for('main.challenge_view', challenge_id=challenge.public_id) }}" class="card-body-link text-light" style="text-decoration: none;">
                                <div class="card-body">
                                    <h5 class="card-title">{{ challenge.name or "Unnamed Challenge" }}</h5>
                                    <h6 class="card-subtitle mb-2 text-secondary">
                                        ID: <code style="font-size: 0.9em;">{{ challenge.public_id[:8] }}...</code> (Shared)
                                    </h6>
                                    <p class="card-text small text-secondary">
                                        Created: {{ challenge.created_at.strftime('%Y-%m-%d %H:%M') if challenge.created_at else 'N/A' }}<br>
                                        Max Groups: {{ challenge.max_groups }}
                                    </p>
                                </div>
                             </a>
                             <div class="card-footer text-right">
                                 <button class="btn btn-sm btn-outline-danger delete-challenge-btn"
                                         data-public-id="{{ challenge.public_id }}"
                                         data-challenge-name="{{ (challenge.name or 'Unnamed Challenge') | escape }}">
                                     <span class="spinner-border spinner-border-sm" style="display: none;"></span>
                                     <span>Delete</span>
                                 </button>
                             </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% elif current_user.is_authenticated and not user_challenges %}
             {# Message handled by JS #}
        {% endif %}
    </div>
    {# --- End Account Challenges Section --- #}


    {# --- Section for Locally Saved Challenges --- #}
    <hr class="my-5"> {# Increased margin #}
    <h3 class="mb-4 section-heading">Saved Locally (This Browser Only)</h3>
    <div id="localChallengesContainer" class="row">
        {# JS populates this with .local-challenge-item divs containing .list-card.glass-effect #}
        <div class="col-12"><p class="text-secondary">Loading local challenges...</p></div>
    </div>
     {# --- End Local Challenges Section --- #}


    {# Message shown only if BOTH DB and Local lists end up empty #}
     <div id="noChallengesMessageContainer" class="col-12 d-none">
          <p class="text-secondary text-center py-5">You have no challenges saved either to your account or locally in this browser.</p>
     </div>


</div> {# End container #}

{# Data div for my_challenges.js #}
<div id="myData" style="display: none;" aria-hidden="true"
    data-is-authenticated="{{ current_user.is_authenticated | lower }}"
    data-csrf-token="{{ csrf_token() }}"
    data-view-local-url="/challenge/"
></div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    {# Load JS files needed for this page #}
    <script type="module" src="{{ url_for('static', filename='js/utils/helpers.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/utils/api.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/utils/local_storage.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/my_challenges.js') }}"></script>
{% endblock %}

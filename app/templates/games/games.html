{# app/templates/games/games.html #}

{% extends "base.html" %}
{% block title %}Games Configuration{% endblock %}
{% import "_form_helpers.html" as forms %}

{% block head %}
    {{ super() }}
    <style>
        body { 
            background-color: var(--base-bg, #030712);
            color: var(--text-primary, #e0e0e0);
        }
        .config-page-container .page-title {
            color: var(--text-accent, #67a3ff);
            font-weight: 600;
        }
        .config-page-container .text-secondary {
            color: var(--text-secondary, #adb5bd) !important;
        }
        .nav-tabs {
            border-bottom-color: var(--surface-border-light, #495057); /* Slightly more prominent bottom border for the whole tab bar */
        }
        .nav-tabs .nav-link {
            border-color: var(--surface-border, #343a40);
            color: var(--text-secondary, #adb5bd);
            border-bottom-width: 0;
            margin-right: 2px;
            transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
            border-radius: var(--border-radius-sm, 0.25rem) var(--border-radius-sm, 0.25rem) 0 0 !important; /* Rounded top corners for all tabs */
        }
        .nav-tabs .nav-link:hover:not(.active) {
            background-color: var(--surface-highlight, rgba(255,255,255,0.05));
            border-color: var(--surface-border, #495057);
            color: var(--text-primary, #e0e0e0);
        }
        .nav-tabs .nav-link.active {
            background-color: var(--surface-card, #1f2937);
            color: var(--text-accent, #67a3ff);
            border-color: var(--surface-border, #343a40);
            border-bottom-color: transparent;
            font-weight: 500;
        }
        .tab-content {
            background-color: var(--surface-card, #1f2937);
            border: 1px solid var(--surface-border, #343a40);
            border-top: none;
            padding: 1.5rem;
            border-radius: 0 0 var(--border-radius, 0.375rem) var(--border-radius, 0.375rem);
        }
        .action-button-row {
            padding-bottom: 1rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--surface-border-light, #495057);
        }
        .action-button-row .btn {
            margin-right: 0.5rem;
        }
        .action-button-row .btn i {
            margin-right: 0.35rem;
        }
        .add-tab-button {
            font-size: 1.1rem;
            padding: 0.5rem 0.8rem;
        }
        .add-tab-button:hover i {
            color: var(--text-accent-hover, #8bbaff);
        }
        .loading-placeholder-text {
            color: var(--text-secondary);
        }
        .config-table th {
             background-color: var(--surface-header, rgba(255, 255, 255, 0.05));
        }

        /* Styles for tab grouping */
        .tabs-separator {
            height: 1px;
            background-color: var(--surface-border-light, #495057);
            margin: 0.5rem 0.75rem; /* Adjust margin to align with tab padding/margins */
            flex-grow: 0; /* Don't let it grow */
            width: auto; /* Let it take width based on margins or parent */
            align-self: stretch; /* Make it take full height of a tab if needed, or use padding */
            display: none; /* Initially hidden, JS will show it */
            list-style-type: none; /* Remove bullet if it's an li */
        }
        /* Alternative: small vertical spacer */
        .tabs-spacer {
            width: 10px; /* Adjust as needed for a small visual gap */
            display: none; /* Initially hidden */
            list-style-type: none;
        }
        .nav-tabs .nav-item.system-default-group-label,
        .nav-tabs .nav-item.custom-group-label {
            align-self: center;
            padding: 0.5rem 0.75rem;
            font-size: 0.8rem;
            color: var(--text-muted, #6c757d);
            font-style: italic;
            display: none; /* Initially hidden */
        }

    </style>
{% endblock %}


{% block content %}
<div class="container mt-4 mb-5 config-page-container">
  <header class="mb-4 text-center">
    <h2 class="page-title"><i class="bi bi-joystick me-2"></i>Games Configuration</h2>
    <p class="text-secondary lead fs-6">
      Create, customize, and manage your game lists for generating unique challenges.
    </p>
  </header>

  <script>
    const isLoggedIn = {{ current_user.is_authenticated| tojson }};
    const csrfToken = "{{ csrf_token() }}";
    window.isLoggedIn = isLoggedIn;
    window.csrfToken = csrfToken;
    window.SYSTEM_DEFAULT_GAME_TABS = {}; 
  </script>

  {% if current_user.is_authenticated %}
  <div class="d-flex justify-content-between align-items-center mb-3 action-button-row">
      <div class="btn-group" role="group" aria-label="Tab Actions">
          <button id="duplicateTabBtn" class="btn btn-outline-info btn-sm" title="Create a copy of the current tab">
              <i class="bi bi-front"></i>Duplicate Tab
          </button>
          <button id="deleteTabBtn" class="btn btn-outline-danger btn-sm" title="Delete the currently active custom tab">
              <i class="bi bi-trash3"></i>Delete Current Tab
          </button>
      </div>
      <small class="text-secondary">Max 5 custom tabs allowed (excluding system defaults).</small>
  </div>
  {% endif %}

  {# --- Tabs Navigation --- #}
  <ul class="nav nav-tabs mb-0 d-flex flex-wrap" id="gamesTab" role="tablist">
    {# JS will insert:
        1. System default tabs
        2. A separator (if custom tabs exist)
        3. Custom tabs
        4. The "Add Tab" button & loading placeholder (which are moved by JS to the end)
    #}
    <li class="nav-item system-default-group-label" id="systemTabsLabel">Default Sets</li>
    
    {# Placeholder for the separator - JS will control its visibility and content/styling if needed #}
    <li class="tabs-spacer" id="customTabsSeparator"></li> 
    
    <li class="nav-item custom-group-label" id="customTabsLabel">Your Custom Sets</li>

    {# "Add Tab" button and loading placeholder will be managed by JS to be at the end #}
    <li class="nav-item ms-auto order-last"> {# ms-auto to push to right, order-last to visually be last #}
      <a class="nav-link add-tab-button" href="#" id="addTabBtn" role="tab" title="Add New Custom Tab">
        <i class="bi bi-plus-lg"></i> 
      </a>
    </li>
    <li id="loadingTabsPlaceholder" class="nav-item align-self-center order-last" style="display: none;">
      <span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
      <span class="loading-placeholder-text small">Loading Tabs...</span>
    </li>
  </ul>
  {# --- End Tabs Navigation --- #}

  <div class="tab-content" id="gamesTabContent">
    {# JS will insert tab panes here #}
  </div>

  {{ forms.confirm_action_modal(modal_id='actionConfirmModal', title_id='actionConfirmTitle', body_id='actionConfirmBody', ok_id='actionConfirmOk') }}
  {% include "games/games_modals.html" %}
  {{ forms.rename_tab_modal('game') }}

</div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script type="module" src="{{ url_for('static', filename='js/utils/api.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/utils/helpers.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/games/localStorageUtils.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/games/tabManagement.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/games/entryManagement.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/games/gamesExtensions.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/games/games.js') }}"></script>
{% endblock %}

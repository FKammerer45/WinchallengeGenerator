{# app/templates/games/games.html #}

{% extends "base.html" %}
{% block title %}Games Configuration{% endblock %}
{% import "_form_helpers.html" as forms %}

{% block head %}
    {{ super() }}
    {# Link the new dedicated CSS for tab styling #}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/tabs.css') }}">
    
{% endblock %}


{% block content %}
<div class="container mt-4 mb-5 config-page-container">
  <header class="mb-4 text-center">
    <h2 class="page-title"><i class="bi bi-joystick me-2"></i>Games Configuration</h2>
    <p class="text-secondary lead fs-6">
      Create, customize, and manage your game lists for generating unique challenges.
    </p>
  </header>

  <script>
    const isLoggedIn = {{ current_user.is_authenticated| tojson }};
    const csrfToken = "{{ csrf_token() }}";
    window.isLoggedIn = isLoggedIn;
    window.csrfToken = csrfToken;
    window.SYSTEM_DEFAULT_GAME_TABS = {}; 
  </script>

  {% if current_user.is_authenticated %}
  <div class="d-flex justify-content-between align-items-center mb-3 action-button-row">
      <div class="btn-group" role="group" aria-label="Tab Actions">
          <button id="duplicateTabBtn" class="btn btn-outline-info btn-sm" title="Create a copy of the current tab">
              <i class="bi bi-front"></i>Duplicate Tab
          </button>
          <button id="deleteTabBtn" class="btn btn-outline-danger btn-sm" title="Delete the currently active custom tab">
              <i class="bi bi-trash3"></i>Delete Current Tab
          </button>
      </div>
      <small class="text-secondary">Max 5 custom tabs allowed (excluding system defaults).</small>
  </div>
  {% endif %}

  {# --- Tabs Navigation --- #}
  <div class="nav-tabs-wrapper"> {# ADDED WRAPPER DIV #}
    <ul class="nav nav-tabs mb-0 d-flex flex-wrap" id="gamesTab" role="tablist">
      <li class="nav-item system-default-group-label" id="systemTabsLabel">Default Sets</li>
      
      {# UPDATED SEPARATOR CLASS #}
      <li class="tabs-separator-item" id="customTabsSeparator"></li> 
      
      <li class="nav-item custom-group-label" id="customTabsLabel">Your Custom Sets</li>

      <li class="nav-item ms-auto order-last"> 
        <a class="nav-link add-tab-button" href="#" id="addTabBtn" role="tab" title="Add New Custom Tab">
          <i class="bi bi-plus-lg"></i> 
        </a>
      </li>
      <li id="loadingTabsPlaceholder" class="nav-item align-self-center order-last" style="display: none;">
        <span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span>
        <span class="loading-placeholder-text small">Loading Tabs...</span>
      </li>
    </ul>
  </div>
  {# --- End Tabs Navigation --- #}

  <div class="tab-content" id="gamesTabContent">
    {# JS will insert tab panes here #}
  </div>

  {{ forms.confirm_action_modal(modal_id='actionConfirmModal', title_id='actionConfirmTitle', body_id='actionConfirmBody', ok_id='actionConfirmOk') }}
  {% include "games/games_modals.html" %}
  {{ forms.rename_tab_modal('game') }}

</div>
{% endblock %}

{% block scripts %}
    {{ super() }}
    <script type="module" src="{{ url_for('static', filename='js/utils/api.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/utils/helpers.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/games/localStorageUtils.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/games/tabManagement.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/games/entryManagement.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/games/gamesExtensions.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/games/games.js') }}"></script>
{% endblock %}

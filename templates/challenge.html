{% extends "base.html" %}
{% block title %}Alle akzeptierten Challenges{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Alle akzeptierten Challenges</h1>

    {% if challenges %}
    <!-- Bootstrap Nav-Tabs für jede akzeptierte Challenge -->
    <ul class="nav nav-tabs" id="challengeTabs" role="tablist">
        {% for c in challenges %}
        <li class="nav-item">
            <a class="nav-link {% if loop.first %}active{% endif %}" id="challenge-tab-{{ loop.index }}"
                data-toggle="tab" href="#challenge-{{ loop.index }}" role="tab"
                aria-controls="challenge-{{ loop.index }}"
                aria-selected="{% if loop.first %}true{% else %}false{% endif %}">
                Challenge {{ loop.index }}
            </a>
        </li>
        {% endfor %}
    </ul>

    <div class="tab-content mt-3" id="challengeTabsContent">
        {% for c in challenges %}
        <div class="tab-pane fade {% if loop.first %}show active{% endif %}" id="challenge-{{ loop.index }}"
            role="tabpanel" aria-labelledby="challenge-tab-{{ loop.index }}">

            <!-- Gemeinsame Darstellung in einem einzigen Card-Container -->
            <div class="card" style="background-color:#1E1E1E; border:1px solid #357ABD; color:#DCDCDC;">
                <div class="card-header">
                    <strong>Challenge Ergebnis</strong>
                </div>
                <div class="card-body">
                    <!-- Normal Wins Abschnitt -->
                    {% if c.normal %}
                    <h5>Normal Wins</h5>
                    <table class="table table-dark table-striped">
                        <thead>
                            <tr>
                                <th style="width:35%;">Spiel</th>
                                <th style="width:25%;">Wins</th>
                                <th style="width:40%;">Checkboxen</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for key, info in c.normal.items() %}
                            <tr>
                                <td>
                                    {{ key }}<br>
                                    (Summe Schwierigkeit: {{ info.diff|round(2) }})
                                </td>
                                <td>{{ info.count }}</td>
                                <td>
                                    {% for i in range(info.count) %}
                                    <input type="checkbox" class="form-check-input mr-1">
                                    {% endfor %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% endif %}

                    <!-- Back-to-Back Wins Abschnitt -->
                    {% if c.b2b %}
                    <hr style="border-top: 1px solid #357ABD;">
                    <p class="text-center font-italic" style="margin-top:-10px;">Back-to-Back Wins</p>
                    <table class="table table-dark table-striped">
                        <thead>
                            <tr>
                                <th style="width:35%;">Spiel</th>
                                <th style="width:25%;">Wins</th>
                                <th style="width:40%;">Checkboxen</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for seg in c.b2b %}
                            {% set seg_index = loop.index %}
                            {% for key, count in seg.group.items() %}
                            <tr>
                                <td>
                                    Segment {{ seg_index }} - {{ key }}<br>
                                    <small>({{ seg.length }} wins, Diff: {{ seg.seg_diff|round(2) }})</small>
                                </td>
                                <td>{{ count }}</td>
                                <td>
                                    {% for i in range(count) %}
                                    <input type="checkbox" class="form-check-input mr-1">
                                    {% endfor %}
                                </td>
                            </tr>
                            {% endfor %}
                            {% endfor %}
                        </tbody>
                    </table>
                    {% endif %}
                </div>
            </div>

        </div>
        {% endfor %}
    </div>
    {% else %}
    <p>Keine Challenges akzeptiert.</p>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
    // Hier kannst du den Timer-Code für jeden Tab separat implementieren, falls erforderlich.
    // Beispiel: Separate Timer-Funktionen für jeden Tab können über eindeutige IDs gesteuert werden.
</script>
{% endblock %}